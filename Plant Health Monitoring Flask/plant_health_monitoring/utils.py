import base64
from io import BytesIO
from PIL import Image
import numpy as np
from keras.models import load_model,save_model
from keras.utils import get_file
import requests
#from plant_health_monitoring import app, models

imgData = """data:image/png;base64,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"""

# file = get_file(origin ='https://srv-store2.gofile.io/download/TPzD7d/Cherry_dieases.h5',fname='Cherry_dieases.h5')
# r = requests.get('https://srv-store2.gofile.io/download/TPzD7d/Cherry_dieases.h5',stream=True)
model = load_model(get_file(origin ='https://srv-store2.gofile.io/download/TPzD7d/Cherry_dieases.h5',fname='Cherry_dieases.h5'))
print(model)

img =imgData.split(',')[-1]
img = base64.b64decode(img)
img = Image.open(BytesIO(img))
img.show()    
a = np.array(img)[:,:,:3]
print(a.shape)
a = a.reshape(-1,28,28,3)
print(model.predict(a))

# save_model(model,'try.h5',include_optimizer=False)
